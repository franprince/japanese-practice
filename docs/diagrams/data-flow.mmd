graph TD
    subgraph Sources
        KD[kanaDictionary.json]
        JD[jmdict-spa.json]
    end

    subgraph Build["Build Process"]
        BWM[buildWordsInMain]
        API["/api/wordset (Static Endpoint)"]
    end

    subgraph Client["Client Browser"]
        IDB[(IndexedDB\nkana-words)]
        App[Application State]
        Logic[Loader Logic]
    end

    KD & JD --> BWM
    BWM -->|Static Gen| API
    BWM -.->|Fallback / Worker| Logic

    API -->|Fetch| Logic
    Logic -->|1. Check| IDB
    IDB -- "Hit" --> Logic
    Logic -- "Hit/Miss (Update)" --> IDB
    Logic -->|Load| App

    classDef database fill:#e1f5fe,stroke:#01579b,stroke-width:2px;
    classDef component fill:#f3e5f5,stroke:#4a148c,stroke-width:2px;
    classDef source fill:#fff3e0,stroke:#e65100,stroke-width:2px;

    class IDB database;
    class App,Logic,BWM,API component;
    class KD,JD source;
