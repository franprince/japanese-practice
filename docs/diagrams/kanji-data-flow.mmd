flowchart TD
    subgraph Sources["ðŸ“‚ Data Sources"]
        KF[("kanji-frequency\n(scriptin/kanji-frequency)")]
        JME[("jmdict-eng-3.6.2.json\n(JMDict English)")]
        JMS[("jmdict-spa-3.6.1.json\n(JMDict Spanish)")]
    end

    subgraph Build["ðŸ”§ Build Process (build-kanjiset.ts)"]
        MU["most_used_kanjis.json\n(Frequency Ranked)"]
        
        subgraph Fallback["Fallback Pipeline"]
            F1["1. JMDict Lookup\n(meanings from dictionaries)"]
            F2["2. Previous Dataset Cache\n(reuse known entries)"]
            F3["3. Jisho API\n(fetch missing data)"]
            F4["4. Playwright Scrape\n(final fallback)"]
        end
        
        KS[("kanjiset-vN.json\n(Complete Dataset)")]
    end

    subgraph Delivery["ðŸš€ Delivery"]
        N5["kanji-n5.json"]
        N4["kanji-n4.json"]
        N3["kanji-n3.json"]
        N2["kanji-n2.json"]
        N1["kanji-n1.json"]
    end

    subgraph Client["ðŸ“± Client"]
        IDB[("IndexedDB Cache\n(7-day expiry)")]
        APP["Kanji Game"]
    end

    KF --> MU
    JME --> F1
    JMS --> F1
    MU --> F1
    F1 --> F2
    F2 --> F3
    F3 --> F4
    F4 --> KS
    KS --> N5
    KS --> N4
    KS --> N3
    KS --> N2
    KS --> N1
    N5 & N4 & N3 & N2 & N1 --> APP
    APP <--> IDB
